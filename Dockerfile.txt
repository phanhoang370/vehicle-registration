FROM richarvey/nginx-php-fpm:2.2.0  # Image hỗ trợ PHP 8.1+ và Laravel

# Copy code vào container
COPY . /var/www/html

# Cài dependencies (Composer)
RUN composer install --no-dev --optimize-autoloader

# Set permissions
RUN chown -R www-data:www-data /var/www/html/storage /var/www/html/bootstrap/cache

# Env vars (Laravel config)
ENV SKIP_COMPOSER=1
ENV WEBROOT=/var/www/html/public
ENV PHP_ERRORS_STDERR=1
ENV RUN_SCRIPTS=1
ENV APP_ENV=production
ENV APP_DEBUG=false

# Start script (tùy chọn, để chạy migration)
CMD ["/start.sh"]